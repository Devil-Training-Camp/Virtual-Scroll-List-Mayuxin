"use strict";Object.defineProperties(exports,{__esModule:{value:!0},[Symbol.toStringTag]:{value:"Module"}});const e=require("vue"),R=["tId"],x=e.defineComponent({name:"VirtualScrollList"}),z=e.defineComponent({...x,props:{dataSource:{default:()=>[]},estimatedItemSize:{default:100},bufferScale:{default:1}},setup(I){const g=I,{estimatedItemSize:v,bufferScale:b}=e.toRefs(g),s=e.ref([]),m=e.ref(),_=e.ref(0),h=e.ref(0),u=e.ref(0),f=e.ref(0),t=e.ref([]),p=e.ref(0),S=e.ref(),d=e.computed(()=>Math.ceil(_.value/v.value)+1),E=e.computed(()=>`translate3d(0, ${h.value}px, 0)`),k=e.computed(()=>Math.min(u.value,d.value*b.value)),w=e.computed(()=>Math.min(s.value.length-f.value,d.value*b.value)),B=e.computed(()=>s.value.slice(u.value-k.value,f.value+w.value)),M=()=>{t.value=s.value.map((o,a)=>({index:a,height:v.value,top:a*v.value,bottom:(a+1)*v.value})),p.value=t.value[t.value.length-1].bottom};e.watch(g.dataSource,o=>{s.value=o.map((a,l)=>({_id:l,...a})),M()},{immediate:!0}),e.onMounted(()=>{_.value=m.value.clientHeight,f.value=u.value+d.value}),e.onUpdated(async()=>{await e.nextTick(),s.value.length&&([...S.value].forEach(a=>{const l=+a.getAttribute("tId"),{height:r}=a.getBoundingClientRect(),i=t.value[l].height-r;if(i){t.value[l].height=r,t.value[l].bottom=t.value[l].bottom-i;let n=l+1;for(;n<t.value.length;)t.value[n].top=t.value[n-1].bottom,t.value[n].bottom=t.value[n].bottom-i,n++}}),p.value=t.value[t.value.length-1].bottom,y())});const y=()=>{if(u.value>0){let o=t.value[u.value].top-t.value[u.value-k.value].top;h.value=t.value[u.value-1].bottom-o}else h.value=0},C=(o,a)=>{let l=0,r=o.length-1,c=null;for(;l<=r;){let i=Math.floor((l+r)/2),n=o[i].bottom;if(n===a)return i+1;n<a?l=i+1:n>a&&((c===null||c>i)&&(c=i),r=r-1)}return c};function H(){window.requestAnimationFrame(()=>{const o=m.value.scrollTop;u.value=C(t.value,o),f.value=u.value+d.value,y()})}return(o,a)=>(e.openBlock(),e.createElementBlock("div",{ref_key:"containerRef",ref:m,class:"infinite-list-container",onScroll:H},[e.createElementVNode("div",{class:"infinite-list-phantom",style:e.normalizeStyle({height:`${p.value}px`})},null,4),e.createElementVNode("div",{class:"infinite-list",style:e.normalizeStyle({transform:e.unref(E)})},[(e.openBlock(!0),e.createElementBlock(e.Fragment,null,e.renderList(e.unref(B),l=>(e.openBlock(),e.createElementBlock("div",{key:l._id,tId:l._id,class:"infinite-list-item",ref_for:!0,ref_key:"itemsRef",ref:S},[e.renderSlot(o.$slots,"default",{item:l},void 0,!0)],8,R))),128))],4)],544))}});exports.default=z;
